<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>spring源码阅读(一)-----核心流程 | 不喝酒的烟</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.2.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">spring源码阅读(一)-----核心流程</h1><a id="logo" href="/.">不喝酒的烟</a><p class="description">随便写写</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/history/"><i class="fa fa-book"> 历史</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">spring源码阅读(一)-----核心流程</h1><div class="post-meta">2021-03-11<span> | </span><span class="category"><a href="/categories/spring%E6%BA%90%E7%A0%81/">spring源码</a></span></div><a class="disqus-comment-count" href="/2021/03/11/spring%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB(%E5%8D%81)-----SpringBoot%E5%90%AF%E5%8A%A8%E5%92%8C%E5%86%85%E7%BD%AETomcat/#vcomment"><span class="valine-comment-count" data-xid="/2021/03/11/spring%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB(%E5%8D%81)-----SpringBoot%E5%90%AF%E5%8A%A8%E5%92%8C%E5%86%85%E7%BD%AETomcat/"></span><span> 条评论</span></a><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="toc-number">2.</span> <span class="toc-text">单元测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B"><span class="toc-number">3.</span> <span class="toc-text">启动流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">3.1.</span> <span class="toc-text">准备工作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%BA%94%E7%94%A8%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.1.1.</span> <span class="toc-text">设置应用类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%88%9D%E5%A7%8B%E5%8C%96%E5%99%A8%E5%92%8C%E7%9B%91%E5%90%AC%E5%99%A8"><span class="toc-number">3.1.2.</span> <span class="toc-text">设置初始化器和监听器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SpringApplication-run%E6%96%B9%E6%B3%95"><span class="toc-number">3.2.</span> <span class="toc-text">SpringApplication.run方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%B9%B6%E5%90%AF%E5%8A%A8%E7%9B%91%E5%90%AC%E5%99%A8"><span class="toc-number">3.2.1.</span> <span class="toc-text">获取并启动监听器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%9E%84%E5%BB%BA"><span class="toc-number">3.2.2.</span> <span class="toc-text">环境构建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8"><span class="toc-number">3.2.3.</span> <span class="toc-text">创建容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Spring%E5%AE%B9%E5%99%A8%E5%89%8D%E7%BD%AE%E5%A4%84%E7%90%86"><span class="toc-number">3.2.4.</span> <span class="toc-text">Spring容器前置处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%B7%E6%96%B0%E5%AE%B9%E5%99%A8"><span class="toc-number">3.2.5.</span> <span class="toc-text">刷新容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%91%E5%B8%83ApplicationStartedEvent"><span class="toc-number">3.2.6.</span> <span class="toc-text">发布ApplicationStartedEvent</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A7%E8%A1%8CRunners"><span class="toc-number">3.2.7.</span> <span class="toc-text">执行Runners</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E9%85%8D%E7%BD%AE"><span class="toc-number">4.</span> <span class="toc-text">自动化配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E9%85%8D%E7%BD%AE%E6%B3%A8%E8%A7%A3"><span class="toc-number">4.1.</span> <span class="toc-text">自动化配置注解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E9%85%8D%E7%BD%AE%E8%BF%87%E7%A8%8B"><span class="toc-number">4.2.</span> <span class="toc-text">自动化配置过程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E7%BD%AETomcat"><span class="toc-number">5.</span> <span class="toc-text">内置Tomcat</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAWebServer"><span class="toc-number">5.1.</span> <span class="toc-text">创建WebServer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8WebServer"><span class="toc-number">5.2.</span> <span class="toc-text">启动WebServer</span></a></li></ol></li></ol></div></div><div class="post-content"><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>SpringBoot其实就是将我们常用的配置，内置到某个starter里面，当你引用这个starter的时候，不用在通过xml或者JavaConfig来配置，即可开箱即用。我们称Spring是一种约定优于配置的设计范式，那么SpringBoot也可以称作是一种习惯优于配置的设计范式</p>
<h2 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h2><ol>
<li>TestController<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">&quot;/test&quot;</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> final HelloWorldService helloWorldService;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="title">TestController</span>(<span class="params">HelloWorldService helloWorldService</span>)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.helloWorldService = helloWorldService;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@GetMapping</span>(<span class="string">&quot;/hello&quot;</span>)</span><br><span class="line">	<span class="keyword">public</span> <span class="built_in">String</span> <span class="function"><span class="title">hello</span>(<span class="params"><span class="built_in">String</span> name</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> helloWorldService.helloWorld(name);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>HelloWorldService<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorldService</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="built_in">String</span> <span class="function"><span class="title">helloWorld</span>(<span class="params"><span class="built_in">String</span> name</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;hello &quot;</span> + name + <span class="string">&quot;!&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>SampleApplication<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleApplication</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">void</span> <span class="function"><span class="title">main</span>(<span class="params"><span class="built_in">String</span>[] args</span>)</span> &#123;</span><br><span class="line">		SpringApplication.run(SampleApplication.class, args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="启动流程"><a href="#启动流程" class="headerlink" title="启动流程"></a>启动流程</h2><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public <span class="constructor">SpringApplication(ResourceLoader <span class="params">resourceLoader</span>, Class&lt;?&gt;<span class="operator">...</span> <span class="params">primarySources</span>)</span> &#123;</span><br><span class="line">		this.resourceLoader = resourceLoader;</span><br><span class="line">		<span class="module-access"><span class="module"><span class="identifier">Assert</span>.</span></span>not<span class="constructor">Null(<span class="params">primarySources</span>, <span class="string">&quot;PrimarySources must not be null&quot;</span>)</span>;</span><br><span class="line">		this.primarySources = <span class="keyword">new</span> LinkedHashSet&lt;&gt;(<span class="module-access"><span class="module"><span class="identifier">Arrays</span>.</span></span><span class="keyword">as</span><span class="constructor">List(<span class="params">primarySources</span>)</span>);</span><br><span class="line">		<span class="comment">// 设置应用类型是NONE还是SERVLET，或者REACTIVE</span></span><br><span class="line">		this.webApplicationType = <span class="module-access"><span class="module"><span class="identifier">WebApplicationType</span>.</span></span>deduce<span class="constructor">FromClasspath()</span>;</span><br><span class="line">		<span class="comment">// 设置初始化器(Initializer),最后会调用这些初始化器</span></span><br><span class="line">		set<span class="constructor">Initializers((Collection)</span> get<span class="constructor">SpringFactoriesInstances(ApplicationContextInitializer.<span class="params">class</span>)</span>);</span><br><span class="line">		<span class="comment">// 设置监听器(Listener)</span></span><br><span class="line">		set<span class="constructor">Listeners((Collection)</span> get<span class="constructor">SpringFactoriesInstances(ApplicationListener.<span class="params">class</span>)</span>);</span><br><span class="line">		this.mainApplicationClass = deduce<span class="constructor">MainApplicationClass()</span>;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h4 id="设置应用类型"><a href="#设置应用类型" class="headerlink" title="设置应用类型"></a>设置应用类型</h4>设置应用类型比较简单，主要是看有没有某些对应的类。</li>
</ol>
<h4 id="设置初始化器和监听器"><a href="#设置初始化器和监听器" class="headerlink" title="设置初始化器和监听器"></a>设置初始化器和监听器</h4><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> &lt;T&gt; Collection&lt;T&gt; get<span class="constructor">SpringFactoriesInstances(Class&lt;T&gt; <span class="params">type</span>, Class&lt;?&gt;[] <span class="params">parameterTypes</span>, Object<span class="operator">...</span> <span class="params">args</span>)</span> &#123;</span><br><span class="line">		ClassLoader classLoader = get<span class="constructor">ClassLoader()</span>;</span><br><span class="line">		<span class="comment">// Use names and ensure unique to protect against duplicates</span></span><br><span class="line">		Set&lt;String&gt; names = <span class="keyword">new</span> LinkedHashSet&lt;&gt;(<span class="module-access"><span class="module"><span class="identifier">SpringFactoriesLoader</span>.</span></span>load<span class="constructor">FactoryNames(<span class="params">type</span>, <span class="params">classLoader</span>)</span>);</span><br><span class="line">		List&lt;T&gt; instances = create<span class="constructor">SpringFactoriesInstances(<span class="params">type</span>, <span class="params">parameterTypes</span>, <span class="params">classLoader</span>, <span class="params">args</span>, <span class="params">names</span>)</span>;</span><br><span class="line">		<span class="module-access"><span class="module"><span class="identifier">AnnotationAwareOrderComparator</span>.</span></span>sort(instances);</span><br><span class="line">		return instances;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>这里面的设计模式和spring xml解析是用到的设计类似，所有接口的实现类存储在引用包的META-INF/spring.factories里面。对应的所有初始化器和监听器均会被实例化并贯穿SpringBoot整个生命周期。<br><img src="https://cdn.jsdelivr.net/gh/engimatic/privateimage@main/img/spring_factories.png"></p>
<h3 id="SpringApplication-run方法"><a href="#SpringApplication-run方法" class="headerlink" title="SpringApplication.run方法"></a>SpringApplication.run方法</h3><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ConfigurableApplicationContext run(<span class="keyword">String</span>... args) &#123;</span><br><span class="line">		StopWatch stopWatch = <span class="keyword">new</span> <span class="type">StopWatch</span>();</span><br><span class="line">		stopWatch.start();</span><br><span class="line">		ConfigurableApplicationContext context = <span class="literal">null</span>;</span><br><span class="line">		Collection&lt;SpringBootExceptionReporter&gt; exceptionReporters = <span class="keyword">new</span> <span class="type">ArrayList</span>&lt;&gt;();</span><br><span class="line">		configureHeadlessProperty();</span><br><span class="line">		<span class="comment">// 获取并启动监听器</span></span><br><span class="line">		SpringApplicationRunListeners listeners = getRunListeners(args);</span><br><span class="line">		listeners.starting();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			ApplicationArguments applicationArguments = <span class="keyword">new</span> <span class="type">DefaultApplicationArguments</span>(args);</span><br><span class="line">			<span class="comment">// 根据SpringApplicationRunListeners以及参数来准备环境</span></span><br><span class="line">			ConfigurableEnvironment environment = prepareEnvironment(listeners, applicationArguments);</span><br><span class="line">			configureIgnoreBeanInfo(environment);</span><br><span class="line">			Banner printedBanner = printBanner(environment);</span><br><span class="line">			<span class="comment">// 创建Spring容器</span></span><br><span class="line">			context = createApplicationContext();</span><br><span class="line">			exceptionReporters = getSpringFactoriesInstances(SpringBootExceptionReporter.class,</span><br><span class="line">					<span class="keyword">new</span> <span class="type">Class</span>[] &#123; ConfigurableApplicationContext.<span class="class"><span class="keyword">class</span> &#125;, <span class="title">context</span>);</span></span><br><span class="line"><span class="class">			// <span class="title">Spring</span>容器前置处理</span></span><br><span class="line"><span class="class">			<span class="title">prepareContext</span>(<span class="title">context</span>, <span class="title">environment</span>, <span class="title">listeners</span>, <span class="title">applicationArguments</span>, <span class="title">printedBanner</span>);</span></span><br><span class="line"><span class="class">			// 刷新容器</span></span><br><span class="line"><span class="class">			<span class="title">refreshContext</span>(<span class="title">context</span>);</span></span><br><span class="line"><span class="class">			// <span class="title">Spring</span>容器后置处理</span></span><br><span class="line"><span class="class">			<span class="title">afterRefresh</span>(<span class="title">context</span>, <span class="title">applicationArguments</span>);</span></span><br><span class="line"><span class="class">			<span class="title">stopWatch</span>.<span class="title">stop</span>();</span></span><br><span class="line"><span class="class">			<span class="title">if</span> (<span class="title">this</span>.<span class="title">logStartupInfo</span>) </span>&#123;</span><br><span class="line">				<span class="keyword">new</span> <span class="type">StartupInfoLogger</span>(<span class="built_in">this</span>.mainApplicationClass).logStarted(getApplicationLog(), stopWatch);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// 发布启动事件</span></span><br><span class="line">			listeners.started(context);</span><br><span class="line">			<span class="comment">// 执行Runners</span></span><br><span class="line">			callRunners(context, applicationArguments);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">			handleRunFailure(context, ex, exceptionReporters, listeners);</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">IllegalStateException</span>(ex);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			listeners.running(context);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">			handleRunFailure(context, ex, exceptionReporters, <span class="literal">null</span>);</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">IllegalStateException</span>(ex);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> context;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h4 id="获取并启动监听器"><a href="#获取并启动监听器" class="headerlink" title="获取并启动监听器"></a>获取并启动监听器</h4><p>SpringApplicationRunListeners中只获取到一个SpringApplicationRunListener的实现类——EventPublishingRunListener。EventPublishingRunListener在starting的时候会将准备工作中设置的10个监听器都注册到SimpleApplicationEventMulticaster这个广播器中。以下是SpringApplicationRunListener各个方法调用时间点。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> SpringApplicationRunListener &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Called immediately when the run method has first started. Can be used for very</span></span><br><span class="line"><span class="comment">	 * early initialization.</span></span><br><span class="line"><span class="comment">	 * 在run()方法开始执行时，该方法就立即被调用，可用于在初始化最早期时做一些工作</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">default</span> <span class="built_in">void</span> <span class="function"><span class="title">starting</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Called once the environment has been prepared, but before the</span></span><br><span class="line"><span class="comment">	 * &#123;<span class="doctag">@link </span>ApplicationContext&#125; has been created.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param </span>environment the environment</span></span><br><span class="line"><span class="comment">	 * 当environment构建完成，ApplicationContext创建之前，该方法被调用</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">default</span> <span class="built_in">void</span> <span class="function"><span class="title">environmentPrepared</span>(<span class="params">ConfigurableEnvironment environment</span>)</span> &#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Called once the &#123;<span class="doctag">@link </span>ApplicationContext&#125; has been created and prepared, but</span></span><br><span class="line"><span class="comment">	 * before sources have been loaded.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param </span>context the application context</span></span><br><span class="line"><span class="comment">	 * 当ApplicationContext构建完成时，该方法被调用</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">default</span> <span class="built_in">void</span> <span class="function"><span class="title">contextPrepared</span>(<span class="params">ConfigurableApplicationContext context</span>)</span> &#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Called once the application context has been loaded but before it has been</span></span><br><span class="line"><span class="comment">	 * refreshed.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param </span>context the application context</span></span><br><span class="line"><span class="comment">	 * 在ApplicationContext完成加载，但没有被刷新前，该方法被调用</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">default</span> <span class="built_in">void</span> <span class="function"><span class="title">contextLoaded</span>(<span class="params">ConfigurableApplicationContext context</span>)</span> &#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * The context has been refreshed and the application has started but</span></span><br><span class="line"><span class="comment">	 * &#123;<span class="doctag">@link </span>CommandLineRunner CommandLineRunners&#125; and &#123;<span class="doctag">@link <span class="variable">ApplicationRunner</span></span></span></span><br><span class="line"><span class="comment">	 * ApplicationRunners&#125; have not been called.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param </span>context the application context.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@since </span>2.0.0</span></span><br><span class="line"><span class="comment">	 * 在ApplicationContext刷新并启动后，CommandLineRunners和ApplicationRunner未被调用前，该方法被调用</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">default</span> <span class="built_in">void</span> <span class="function"><span class="title">started</span>(<span class="params">ConfigurableApplicationContext context</span>)</span> &#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Called immediately before the run method finishes, when the application context has</span></span><br><span class="line"><span class="comment">	 * been refreshed and all &#123;<span class="doctag">@link </span>CommandLineRunner CommandLineRunners&#125; and</span></span><br><span class="line"><span class="comment">	 * &#123;<span class="doctag">@link </span>ApplicationRunner ApplicationRunners&#125; have been called.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param </span>context the application context.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@since </span>2.0.0</span></span><br><span class="line"><span class="comment">	 * 在run()方法执行完成前该方法被调用</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">default</span> <span class="built_in">void</span> <span class="function"><span class="title">running</span>(<span class="params">ConfigurableApplicationContext context</span>)</span> &#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Called when a failure occurs when running the application.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param </span>context the application context or &#123;<span class="doctag">@code </span>null&#125; if a failure occurred before</span></span><br><span class="line"><span class="comment">	 * the context was created</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param </span>exception the failure</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@since </span>2.0.0</span></span><br><span class="line"><span class="comment">	 * 当应用运行出错时该方法被调用</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">default</span> <span class="built_in">void</span> <span class="function"><span class="title">failed</span>(<span class="params">ConfigurableApplicationContext context, Throwable exception</span>)</span> &#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="环境构建"><a href="#环境构建" class="headerlink" title="环境构建"></a>环境构建</h4><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ConfigurableEnvironment environment = this.prepare<span class="constructor">Environment(<span class="params">listeners</span>, <span class="params">applicationArguments</span>)</span>;</span><br></pre></td></tr></table></figure>
<p>prepareEnvironment不仅是准备环境，还会发布ApplicationEnvironmentPreparedEvent事件，即调用SpringApplicationRunListener的environmentPrepared方法，通知监听器环境已准备完成。监听了ApplicationEnvironmentPreparedEvent时间的监听器有7个<img src="https://cdn.jsdelivr.net/gh/engimatic/privateimage@main/img/ApplicationEnvironmentPreparedEvent.png"><br>比如第一个ConfigFileApplicationListener，就非常重要。它的功能就是用来处理项目配置，也就是我们常见的properties或者yaml文件。<br>当事件是ApplicationEnvironmentPreparedEvent时，从META-INF/spring.factories找到EnvironmentPostProcessor对应的实现类，将自己添加到最后，然后依次处理。最终environment里会加载多个配置，前面的配置变量会覆盖后面同名的配置变量。</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> void on<span class="constructor">ApplicationEnvironmentPreparedEvent(ApplicationEnvironmentPreparedEvent <span class="params">event</span>)</span> &#123;</span><br><span class="line">		List&lt;EnvironmentPostProcessor&gt; postProcessors = load<span class="constructor">PostProcessors()</span>;</span><br><span class="line">		postProcessors.add(this);</span><br><span class="line">		<span class="module-access"><span class="module"><span class="identifier">AnnotationAwareOrderComparator</span>.</span></span>sort(postProcessors);</span><br><span class="line">		<span class="keyword">for</span> (EnvironmentPostProcessor postProcessor : postProcessors) &#123;</span><br><span class="line">			postProcessor.post<span class="constructor">ProcessEnvironment(<span class="params">event</span>.<span class="params">getEnvironment</span>()</span>, event.get<span class="constructor">SpringApplication()</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"># Environment Post Processors</span><br><span class="line">org.springframework.boot.env.EnvironmentPostProcessor=\</span><br><span class="line">org.springframework.boot.cloud.CloudFoundryVcapEnvironmentPostProcessor,\</span><br><span class="line">org.springframework.boot.env.SpringApplicationJsonEnvironmentPostProcessor,\</span><br><span class="line">org.springframework.boot.env.SystemEnvironmentPropertySourceEnvironmentPostProcessor,\</span><br><span class="line">org.springframework.boot.reactor.DebugAgentEnvironmentPostProcessor</span><br></pre></td></tr></table></figure>

<h4 id="创建容器"><a href="#创建容器" class="headerlink" title="创建容器"></a>创建容器</h4><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">context</span> = createApplicationContext()<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>这个就比较简单，就是根据环境里面的webApplicationType配置，实例化不同的ConfigurableApplicationContext。</p>
<h4 id="Spring容器前置处理"><a href="#Spring容器前置处理" class="headerlink" title="Spring容器前置处理"></a>Spring容器前置处理</h4><p>prepareContext是容器刷新之前的准备动作。这里包含一个非常关键的操作：将启动类注入容器，为后续开启自动化配置奠定基础。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="built_in">void</span> prepareContext(ConfigurableApplicationContext context, ConfigurableEnvironment environment,</span><br><span class="line">			SpringApplicationRunListeners listeners, ApplicationArguments applicationArguments, Banner printedBanner) &#123;</span><br><span class="line">		<span class="comment">// 设置容器环境，包括各种变量</span></span><br><span class="line">		context.setEnvironment(environment);</span><br><span class="line">		<span class="comment">// 执行容器后置处理</span></span><br><span class="line">		postProcessApplicationContext(context);</span><br><span class="line">		<span class="comment">// 行容器中的ApplicationContextInitializer</span></span><br><span class="line">		applyInitializers(context);</span><br><span class="line">		<span class="comment">// 发送容器已经准备好的事件，通知各监听器</span></span><br><span class="line">		listeners.contextPrepared(context);</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">this</span>.logStartupInfo) &#123;</span><br><span class="line">			logStartupInfo(context.getParent() == <span class="literal">null</span>);</span><br><span class="line">			logStartupProfileInfo(context);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// Add boot specific singleton beans</span></span><br><span class="line">		ConfigurableListableBeanFactory beanFactory = context.getBeanFactory();</span><br><span class="line">		beanFactory.registerSingleton(<span class="string">&quot;springApplicationArguments&quot;</span>, applicationArguments);</span><br><span class="line">		<span class="keyword">if</span> (printedBanner != <span class="literal">null</span>) &#123;</span><br><span class="line">			beanFactory.registerSingleton(<span class="string">&quot;springBootBanner&quot;</span>, printedBanner);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (beanFactory <span class="keyword">instanceof</span> DefaultListableBeanFactory) &#123;</span><br><span class="line">			((DefaultListableBeanFactory) beanFactory)</span><br><span class="line">					.setAllowBeanDefinitionOverriding(<span class="built_in">this</span>.allowBeanDefinitionOverriding);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">this</span>.lazyInitialization) &#123;</span><br><span class="line">			context.addBeanFactoryPostProcessor(<span class="keyword">new</span> LazyInitializationBeanFactoryPostProcessor());</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// Load the sources</span></span><br><span class="line">		<span class="built_in">Set</span>&lt;<span class="built_in">Object</span>&gt; sources = getAllSources();</span><br><span class="line">		Assert.notEmpty(sources, <span class="string">&quot;Sources must not be empty&quot;</span>);</span><br><span class="line">		<span class="comment">// 加载启动类，将启动类注入容器</span></span><br><span class="line">		load(context, sources.toArray(<span class="keyword">new</span> <span class="built_in">Object</span>[<span class="number">0</span>]));</span><br><span class="line">		<span class="comment">// 发布容器已加载事件</span></span><br><span class="line">		listeners.contextLoaded(context);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>看起来完成了很多功能，实际上最重要的只有一点：将启动类注册到容器中。完成这一功能的核心代码在load方法中，具体的实现和我们前面讲过的注册BeanDefinition类似。</p>
<h4 id="刷新容器"><a href="#刷新容器" class="headerlink" title="刷新容器"></a>刷新容器</h4><p>refresh方法，前面有详细讲解，跳过</p>
<h4 id="发布ApplicationStartedEvent"><a href="#发布ApplicationStartedEvent" class="headerlink" title="发布ApplicationStartedEvent"></a>发布ApplicationStartedEvent</h4><p>listeners.started(context)发布了一个ApplicationStartedEvent，这里是在spring容器中发布事件，ApplicationStartedEvent有两个监听器，这里两个监听器其实什么都没做。</p>
<h4 id="执行Runners"><a href="#执行Runners" class="headerlink" title="执行Runners"></a>执行Runners</h4><p>如果定义了ApplicationRunner或者CommandLineRunner，在此处获取并执行run方法，可以自定义不同的Runner执行一些初始化操作。</p>
<h2 id="自动化配置"><a href="#自动化配置" class="headerlink" title="自动化配置"></a>自动化配置</h2><h3 id="自动化配置注解"><a href="#自动化配置注解" class="headerlink" title="自动化配置注解"></a>自动化配置注解</h3><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Target</span>(ElementType.TYPE)</span><br><span class="line"><span class="variable">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="variable">@Documented</span></span><br><span class="line"><span class="variable">@Inherited</span></span><br><span class="line"><span class="variable">@SpringBootConfiguration</span></span><br><span class="line"><span class="variable">@EnableAutoConfiguration</span></span><br><span class="line"><span class="variable">@ComponentScan</span>(excludeFilters = &#123; <span class="variable">@Filter</span>(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),</span><br><span class="line">		<span class="variable">@Filter</span>(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) &#125;)</span><br><span class="line">public <span class="variable">@interface</span> SpringBootApplication &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Exclude specific auto-configuration classes such that they will never be applied.</span></span><br><span class="line"><span class="comment">	 * @return the classes to exclude</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="variable">@AliasFor</span>(annotation = EnableAutoConfiguration.class)</span><br><span class="line">	Class&lt;?&gt;[] exclude() default &#123;&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Exclude specific auto-configuration class names such that they will never be</span></span><br><span class="line"><span class="comment">	 * applied.</span></span><br><span class="line"><span class="comment">	 * @return the class names to exclude</span></span><br><span class="line"><span class="comment">	 * @since 1.3.0</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="variable">@AliasFor</span>(annotation = EnableAutoConfiguration.class)</span><br><span class="line">	String[] excludeName() default &#123;&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Base packages to scan for annotated components. Use &#123;@link #scanBasePackageClasses&#125;</span></span><br><span class="line"><span class="comment">	 * for a type-safe alternative to String-based package names.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;</span></span><br><span class="line"><span class="comment">	 * &lt;strong&gt;<span class="doctag">Note:</span>&lt;/strong&gt; this setting is an alias for</span></span><br><span class="line"><span class="comment">	 * &#123;@link ComponentScan @ComponentScan&#125; only. It has no effect on &#123;@code @Entity&#125;</span></span><br><span class="line"><span class="comment">	 * scanning or Spring Data &#123;@link Repository&#125; scanning. For those you should add</span></span><br><span class="line"><span class="comment">	 * &#123;@link org.springframework.boot.autoconfigure.domain.EntityScan @EntityScan&#125; and</span></span><br><span class="line"><span class="comment">	 * &#123;@code @Enable...Repositories&#125; annotations.</span></span><br><span class="line"><span class="comment">	 * @return base packages to scan</span></span><br><span class="line"><span class="comment">	 * @since 1.3.0</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="variable">@AliasFor</span>(annotation = ComponentScan.class, attribute = <span class="string">&quot;basePackages&quot;</span>)</span><br><span class="line">	String[] scanBasePackages() default &#123;&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Type-safe alternative to &#123;@link #scanBasePackages&#125; for specifying the packages to</span></span><br><span class="line"><span class="comment">	 * scan for annotated components. The package of each class specified will be scanned.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;</span></span><br><span class="line"><span class="comment">	 * Consider creating a special no-op marker class or interface in each package that</span></span><br><span class="line"><span class="comment">	 * serves no purpose other than being referenced by this attribute.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;</span></span><br><span class="line"><span class="comment">	 * &lt;strong&gt;<span class="doctag">Note:</span>&lt;/strong&gt; this setting is an alias for</span></span><br><span class="line"><span class="comment">	 * &#123;@link ComponentScan @ComponentScan&#125; only. It has no effect on &#123;@code @Entity&#125;</span></span><br><span class="line"><span class="comment">	 * scanning or Spring Data &#123;@link Repository&#125; scanning. For those you should add</span></span><br><span class="line"><span class="comment">	 * &#123;@link org.springframework.boot.autoconfigure.domain.EntityScan @EntityScan&#125; and</span></span><br><span class="line"><span class="comment">	 * &#123;@code @Enable...Repositories&#125; annotations.</span></span><br><span class="line"><span class="comment">	 * @return base packages to scan</span></span><br><span class="line"><span class="comment">	 * @since 1.3.0</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="variable">@AliasFor</span>(annotation = ComponentScan.class, attribute = <span class="string">&quot;basePackageClasses&quot;</span>)</span><br><span class="line">	Class&lt;?&gt;[] scanBasePackageClasses() default &#123;&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Specify whether &#123;@link Bean @Bean&#125; methods should get proxied in order to enforce</span></span><br><span class="line"><span class="comment">	 * bean lifecycle behavior, e.g. to return shared singleton bean instances even in</span></span><br><span class="line"><span class="comment">	 * case of direct &#123;@code @Bean&#125; method calls in user code. This feature requires</span></span><br><span class="line"><span class="comment">	 * method interception, implemented through a runtime-generated CGLIB subclass which</span></span><br><span class="line"><span class="comment">	 * comes with limitations such as the configuration class and its methods not being</span></span><br><span class="line"><span class="comment">	 * allowed to declare &#123;@code final&#125;.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;</span></span><br><span class="line"><span class="comment">	 * The default is &#123;@code true&#125;, allowing for &#x27;inter-bean references&#x27; within the</span></span><br><span class="line"><span class="comment">	 * configuration class as well as for external calls to this configuration&#x27;s</span></span><br><span class="line"><span class="comment">	 * &#123;@code @Bean&#125; methods, e.g. from another configuration class. If this is not needed</span></span><br><span class="line"><span class="comment">	 * since each of this particular configuration&#x27;s &#123;@code @Bean&#125; methods is</span></span><br><span class="line"><span class="comment">	 * self-contained and designed as a plain factory method for container use, switch</span></span><br><span class="line"><span class="comment">	 * this flag to &#123;@code false&#125; in order to avoid CGLIB subclass processing.</span></span><br><span class="line"><span class="comment">	 * &lt;p&gt;</span></span><br><span class="line"><span class="comment">	 * Turning off bean method interception effectively processes &#123;@code @Bean&#125; methods</span></span><br><span class="line"><span class="comment">	 * individually like when declared on non-&#123;@code @Configuration&#125; classes, a.k.a.</span></span><br><span class="line"><span class="comment">	 * &quot;@Bean Lite Mode&quot; (see &#123;@link Bean @Bean&#x27;s javadoc&#125;). It is therefore behaviorally</span></span><br><span class="line"><span class="comment">	 * equivalent to removing the &#123;@code @Configuration&#125; stereotype.</span></span><br><span class="line"><span class="comment">	 * @since 2.2</span></span><br><span class="line"><span class="comment">	 * @return whether to proxy &#123;@code @Bean&#125; methods</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="variable">@AliasFor</span>(annotation = Configuration.class)</span><br><span class="line">	boolean proxyBeanMethods() default true;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>spring在解析类的注解时，会往上解析注解上的注解。那么@SpringBootApplication代表了@ConfigurationPropertiesScan，@ComponentScan，@EnableAutoConfiguration，@SpringBootConfiguration，@AutoConfigurationPackage，@Configuration等一大批注解，另外还Import进来AutoConfigurationImportSelector.class,ConfigurationPropertiesScanRegistrar.class，EnableConfigurationPropertiesRegistrar.class等一大批类。  我们在第七章讲过，这些类都是由ConfigurationClassPostProcessor类解析的。我们在load方法中，将启动类注册到容器中，容器在容器级后置处理器处理时，会对启动类上的注解进行解析。  </p>
<h3 id="自动化配置过程"><a href="#自动化配置过程" class="headerlink" title="自动化配置过程"></a>自动化配置过程</h3><p>关于包扫描的，@AutoConfigurationPackage和@ComponentScan都可以完成。此处最重要的是Import引入的AutoConfigurationImportSelector.class。AutoConfigurationImportSelector属于DeferredImportSelector，会在parse结束时处理。其加载逻辑在DeferredImportSelectorGroupingHandler的processGroupImports方法，</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">DeferredImportSelectorGroupingHandler.<span class="keyword">class</span></span><br><span class="line"></span><br><span class="line">public <span class="literal">void</span> processGroupImports() &#123;</span><br><span class="line">            Iterator var1 = <span class="built_in">this</span>.groupings.values().iterator();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span>(var1.hasNext()) &#123;</span><br><span class="line">                ConfigurationClassParser.DeferredImportSelectorGrouping grouping = (ConfigurationClassParser.DeferredImportSelectorGrouping)var1.next();</span><br><span class="line">                grouping.getImports<span class="function"><span class="params">()</span>.<span class="title">forEach</span><span class="params">((entry) -&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">                    ConfigurationClass configurationClass = (ConfigurationClass)<span class="built_in">this</span>.configurationClasses.get(entry.getMetadata());</span></span></span><br><span class="line"><span class="function"><span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">                    <span class="keyword">try</span> &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">                        ConfigurationClassParser.<span class="built_in">this</span>.processImports(configurationClass, ConfigurationClassParser.<span class="built_in">this</span>.asSourceClass(configurationClass), ConfigurationClassParser.<span class="built_in">this</span>.asSourceClasses(entry.getImportClassName()), <span class="literal">false</span>);</span></span></span><br><span class="line"><span class="function"><span class="params">                    &#125; <span class="keyword">catch</span> (BeanDefinitionStoreException var4) &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">                        <span class="keyword">throw</span> var4;</span></span></span><br><span class="line"><span class="function"><span class="params">                    &#125; <span class="keyword">catch</span> (Throwable var5) &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">                        <span class="keyword">throw</span> <span class="keyword">new</span> BeanDefinitionStoreException(<span class="string">&quot;Failed to process import candidates for configuration class [&quot;</span> + configurationClass.getMetadata().getClassName() + <span class="string">&quot;]&quot;</span>, var5);</span></span></span><br><span class="line"><span class="function"><span class="params">                    &#125;</span></span></span><br><span class="line"><span class="function"><span class="params">                &#125;)</span>;</span></span><br><span class="line"><span class="function">            &#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">        &#125;</span></span><br></pre></td></tr></table></figure>
<p>grouping.getImports()运行时会在AutoConfigurationGroup中解析过滤。系统在META-INF/spring.factories定义了124个自动加载类，不同版本数量可能有所不同。过滤器有OnClassCondition，OnBeanCondition和OnWebApplicationCondition三种。通过过滤器筛选出符合配置的22个自动配置类。</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">AutoConfigurationGroup.<span class="keyword">class</span></span><br><span class="line"></span><br><span class="line">public <span class="literal">void</span> process(AnnotationMetadata annotationMetadata, DeferredImportSelector deferredImportSelector) &#123;</span><br><span class="line">            Assert.state<span class="function"><span class="params">(deferredImportSelector <span class="keyword">instanceof</span> AutoConfigurationImportSelector, () -&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">                <span class="keyword">return</span> <span class="built_in">String</span>.format(<span class="string">&quot;Only %s implementations are supported, got %s&quot;</span>, AutoConfigurationImportSelector.<span class="keyword">class</span>.getSimpleName(), deferredImportSelector.getClass().getName());</span></span></span><br><span class="line"><span class="function"><span class="params">            &#125;)</span>;</span></span><br><span class="line"><span class="function">            <span class="title">AutoConfigurationImportSelector</span>.<span class="title">AutoConfigurationEntry</span> <span class="title">autoConfigurationEntry</span> = <span class="params">((AutoConfigurationImportSelector)deferredImportSelector)</span>.<span class="title">getAutoConfigurationEntry</span><span class="params">(<span class="built_in">this</span>.getAutoConfigurationMetadata(), annotationMetadata)</span>;</span></span><br><span class="line"><span class="function">            <span class="title">this</span>.<span class="title">autoConfigurationEntries</span>.<span class="title">add</span><span class="params">(autoConfigurationEntry)</span>;</span></span><br><span class="line"><span class="function">            <span class="title">Iterator</span> <span class="title">var4</span> = <span class="title">autoConfigurationEntry</span>.<span class="title">getConfigurations</span><span class="params">()</span>.<span class="title">iterator</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">            <span class="title">while</span><span class="params">(var4.hasNext())</span> &#123;</span></span><br><span class="line"><span class="function">                <span class="title">String</span> <span class="title">importClassName</span> = <span class="params">(<span class="built_in">String</span>)</span><span class="title">var4</span>.<span class="title">next</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">                <span class="title">this</span>.<span class="title">entries</span>.<span class="title">putIfAbsent</span><span class="params">(importClassName, annotationMetadata)</span>;</span></span><br><span class="line"><span class="function">            &#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">        &#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/engimatic/privateimage@main/img/EnableAutoConfiguration.png"><br>上述过程就是springboot自动化配置的精髓。</p>
<h2 id="内置Tomcat"><a href="#内置Tomcat" class="headerlink" title="内置Tomcat"></a>内置Tomcat</h2><h3 id="创建WebServer"><a href="#创建WebServer" class="headerlink" title="创建WebServer"></a>创建WebServer</h3><p>对于web应用，我们创建的容器类实际上是ServletWebServerApplicationContext。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="built_in">void</span> <span class="function"><span class="title">onRefresh</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onRefresh();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.createWebServer();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ApplicationContextException(<span class="string">&quot;Unable to start web server&quot;</span>, var2);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>在执行onRefresh方法的时候，会创建web server。<br>ServletWebServerFactory是根据自动配置类ServletWebServerFactoryAutoConfiguration创建，默认创建TomcatWebServer。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="built_in">void</span> <span class="function"><span class="title">createWebServer</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        WebServer webServer = <span class="built_in">this</span>.webServer;</span><br><span class="line">        ServletContext servletContext = <span class="built_in">this</span>.getServletContext();</span><br><span class="line">        <span class="keyword">if</span> (webServer == <span class="literal">null</span> &amp;&amp; servletContext == <span class="literal">null</span>) &#123;</span><br><span class="line">            ServletWebServerFactory factory = <span class="built_in">this</span>.getWebServerFactory();</span><br><span class="line">            <span class="built_in">this</span>.webServer = factory.getWebServer(<span class="keyword">new</span> ServletContextInitializer[]&#123;<span class="built_in">this</span>.getSelfInitializer()&#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (servletContext != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.getSelfInitializer().onStartup(servletContext);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ServletException var4) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ApplicationContextException(<span class="string">&quot;Cannot initialize servlet context&quot;</span>, var4);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">this</span>.initPropertySources();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>所有的Filter被封装为FilterRegistrationBean，DispatcherServlet会被封装成DispatcherServletRegistrationBean，他们都实现了接口ServletContextInitializer，在this.getSelfInitializer()中执行onStartup方法。</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="module-access"><span class="module"><span class="identifier">ServletWebServerApplicationContext</span>.</span></span><span class="keyword">class</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> void self<span class="constructor">Initialize(ServletContext <span class="params">servletContext</span>)</span> throws ServletException &#123;</span><br><span class="line">        this.prepare<span class="constructor">WebApplicationContext(<span class="params">servletContext</span>)</span>;</span><br><span class="line">        this.register<span class="constructor">ApplicationScope(<span class="params">servletContext</span>)</span>;</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">WebApplicationContextUtils</span>.</span></span>register<span class="constructor">EnvironmentBeans(<span class="params">this</span>.<span class="params">getBeanFactory</span>()</span>, servletContext);</span><br><span class="line">        Iterator var2 = this.get<span class="constructor">ServletContextInitializerBeans()</span>.iterator<span class="literal">()</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(var2.has<span class="constructor">Next()</span>) &#123;</span><br><span class="line">            ServletContextInitializer beans = (ServletContextInitializer)var2.next<span class="literal">()</span>;</span><br><span class="line">            beans.on<span class="constructor">Startup(<span class="params">servletContext</span>)</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="启动WebServer"><a href="#启动WebServer" class="headerlink" title="启动WebServer"></a>启动WebServer</h3><p>直接调用webServer.start()启动。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ServletWebServerApplicationContext.class</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> <span class="built_in">void</span> <span class="function"><span class="title">finishRefresh</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.finishRefresh();</span><br><span class="line">        WebServer webServer = <span class="built_in">this</span>.startWebServer();</span><br><span class="line">        <span class="keyword">if</span> (webServer != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.publishEvent(<span class="keyword">new</span> ServletWebServerInitializedEvent(webServer, <span class="built_in">this</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</div><div class="tags"><a href="/tags/spring/"><i class="fa fa-tag"></i>spring</a><a href="/tags/%E6%BA%90%E7%A0%81/"><i class="fa fa-tag"></i>源码</a><a href="/tags/%E6%9E%B6%E6%9E%84/"><i class="fa fa-tag"></i>架构</a></div><div class="post-nav"><a class="next" href="/2021/01/07/spring%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB(%E5%85%AB)-----%E7%90%86%E8%A7%A3AOP/">spring源码阅读(八)-----理解AOP</a></div><div id="vcomment"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script><script>var notify = 'false' == 'true' ? true : false;
var verify = 'false' == 'true' ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'m1L4QofvaTBynd4G4ARXUBIv-gzGzoHsz',
  appKey:'q7tSFtGgIvgO1ScyMtQdvUkR',
  placeholder:'Just so so',
  avatar:'monsterid',
  guest_info:guest_info,
  pageSize:'10'
})
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/spring%E6%BA%90%E7%A0%81/">spring源码</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/spring/" style="font-size: 15px;">spring</a> <a href="/tags/%E6%BA%90%E7%A0%81/" style="font-size: 15px;">源码</a> <a href="/tags/%E6%9E%B6%E6%9E%84/" style="font-size: 15px;">架构</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2021/03/11/spring%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB(%E5%8D%81)-----SpringBoot%E5%90%AF%E5%8A%A8%E5%92%8C%E5%86%85%E7%BD%AETomcat/">spring源码阅读(一)-----核心流程</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/01/07/spring%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB(%E5%85%AB)-----%E7%90%86%E8%A7%A3AOP/">spring源码阅读(八)-----理解AOP</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/12/30/spring%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB(%E4%B8%83)-----%E7%90%86%E8%A7%A3@Configuration/">spring源码阅读(七)-----理解@Configuration</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/12/20/spring%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB(%E5%85%AD)-----ClassPathXmlApplicationContext%E6%B5%81%E7%A8%8B/">spring源码阅读(六)-----ClassPathXmlApplicationContext流程</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/12/18/spring%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB(%E4%BA%94)-----%E7%90%86%E8%A7%A3@Component/">spring源码阅读(五)-----理解@Component</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/12/16/spring%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB(%E5%9B%9B)-----%E7%90%86%E8%A7%A3@Autowired/">spring源码阅读(四)-----理解@Autowired</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/12/14/spring%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB(%E4%B8%89)-----Bean%E7%9A%84%E5%8A%A0%E8%BD%BD/">spring源码阅读(三)-----Bean的加载</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/12/01/spring%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB(%E4%BA%8C)-----BeanDefinition%E7%9A%84%E6%B3%A8%E5%86%8C/">spring源码阅读(二)-----资源加载与BeanDefinition注册</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/12/01/spring%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB(%E4%B8%80)-----%E6%A0%B8%E5%BF%83%E6%B5%81%E7%A8%8B/">spring源码阅读(一)-----核心流程</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2021 <a href="/." rel="nofollow">不喝酒的烟.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/miku.model.json"},"display":{"position":"right","width":350,"height":650},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>